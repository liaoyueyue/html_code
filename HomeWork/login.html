<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>登录界面</title>
    <link rel="stylesheet" href="css/login.css" />
    <script>
      function submit() {
        let user = document.getElementById("user").value;
        let psw = document.getElementById("psw").value;
        let loginData = JSON.parse(localStorage.getItem("loginData"));
        if (loginData != null && loginData != undefined) {
          let val = loginData.some((item) => {
            return item.name == user && item.psw == psw;
          });
          if (val) {
            window.location.href = "success.html?user=" + user;
          } else {
            alert("账户或密码错误，请重新输入");
          }
        } else {
          alert("账号不存在，请重新输入");
        }
      }

      function reg() {
        let user = document.getElementById("userNew").value;
        let psw = document.getElementById("pswOne").value;
        let psws = document.getElementById("pswTwo").value;
        if (psw != psws) {
          alert("密码输入不一致，请重新输入");
        } else {
          //字符串转化为对象
          let loginData = JSON.parse(localStorage.getItem("loginData"));
          if (loginData === null) {
            loginData = [];
          }
          let val = loginData.some((item) => {
            return item.name == user;
          });
          if (val) {
            alert("账户已经存在，请重新输入");
          } else {
            loginData.push({ name: user, psw: psw });
            localStorage.setItem("loginData", JSON.stringify(loginData));
            window.location.href = "login.html";
          }
        }
      }

      //let 一种块级作用域变量，避免一些var关键字的问题。
      let flag = 1;
      function register() {
        if (flag) {
          //这里flag为真，默认登录块显示，注册块隐藏
          flag = 0;
          // 设置flag=0后应改：注册块显示，登录块隐藏
          document.getElementById("register").style.display = "block";
          document.getElementById("login").style.display = "none";
          //修改提示
          document.getElementById("h1-text").innerHTML = "注册";
          document.getElementById("tips-span").innerHTML = "登录";
          //更换注册图片
          document
            .querySelector(".login-img")
            .classList.add("add-class-login-img");
          document
            .querySelector(".register-img")
            .classList.add("add-class-register-img");
          document
            .querySelector(".login-img")
            .classList.remove("add-class-login-img-show");
          //更换背景颜色
          document.querySelector(".content").classList.add("add-class-content");
        } else {
          //这里flag为假，默认注册块显示，登录块隐藏
          flag = 1;
          // 设置flag=1后应改：登录块显示，注册块隐藏
          document.getElementById("login").style.display = "block";
          document.getElementById("register").style.display = "none";
          //修改提示
          document.getElementById("h1-text").innerHTML = "登录";
          document.getElementById("tips-span").innerHTML = "注册";
          //更换登录图片
          document
            .querySelector(".login-img")
            .classList.remove("add-class-login-img");
          document
            .querySelector(".register-img")
            .classList.remove("add-class-register-img");
          document
            .querySelector(".login-img")
            .classList.add("add-class-login-img-show");
          //更换背景颜色
          document
            .querySelector(".content")
            .classList.remove("add-class-content");
        }
      }
    </script>
  </head>
  <body>
    <div class="box">
      <div class="content">
        <img src="images/login.png" class="login-img" />
        <img src="images/register.png" class="register-img" />

        <div class="login-wrapper">
          <div class="top-title">
            <h1 class="h1-text" id="h1-text">登录</h1>
            <span class="tips-span" id="tips-span" onclick="register()"
              >注册</span
            >
          </div>

          <!-- 登录表单 -->
          <div class="login-form" id="login">
            <div class="user-form">
              <div class="text-tips">
                <span>账号</span>
              </div>
              <input type="text" id="user" required />
            </div>
            <div class="password-form">
              <div class="text-tips">
                <span>密码</span>
                <span class="forgot-password">忘记密码?</span>
              </div>
              <input type="password" id="psw" required />
            </div>
            <button class="btn" onclick="submit()">登录</button>
          </div>

          <!-- 注册表单 -->
          <div class="register-form" id="register">
            <div class="user-form">
              <div class="text-tips">
                <span>账号</span>
              </div>
              <input type="text" id="userNew" required />
            </div>
            <div class="password-form">
              <div class="text-tips">
                <span>密码</span>
              </div>
              <input type="password" id="pswOne" required />
            </div>
            <div class="password-form">
              <div class="text-tips">
                <span>确认密码</span>
              </div>
              <input type="password" id="pswTwo" required />
            </div>
            <button class="btn" onclick="reg()">注册</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
